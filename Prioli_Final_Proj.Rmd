---
title: "Comparing World Quality of Life Measures:  \nNonparametric vs. Parametric Approaches"
author: "Katherine M. Prioli"
date: "December 20, 2018"
output:
  pdf_document: default
  html_document: default
geometry: margin = 0.5in
references:
- URL: https://data.worldbank.org/indicator/ny.gdp.mktp.cd?view=map&year_high_desc=true 
  author:
  - family: The World Bank
  id: worldbank_gdp
  issued:
    year: 2018
  title: Gross Domestic Product
- URL: http://apps.who.int/gho/data/view.main.SDG2016LEXv?lang=en
  author:
  - family: World Health Organization
  id: who_life
  issued:
    year: 2018
  title: Life Expectancy
- URL: http://apps.who.int/gho/data/view.main.182?lang=en
  author:
  - family: World Health Organization
  id: who_infantmort
  issued:
    year: 2018
  title: Probability of Dying per 1000 Live Births
- URL: http://hdr.undp.org/en/content/human-development-index-hdi
  author:
  - family:  The United Nations Development Programme
  id: un_dvlpt_HDIdesc
  issued:
    year: 2018
  title: Human Development Reports - Human Development Index (HDI)
- URL: http://hdr.undp.org/en/data
  author:
  - family: The United Nations Development Programme
  id: un_dvlpt
  issued:
    year: 2018
  title: Human Development Index
- URL: https://www.socialprogress.org/index
  author:
  - family: Social Progress Imperative
  id: socialprog_desc
  issued:
    year: 2018
  title:  Social Progress Index - Overview
- URL: https://www.socialprogress.org/?tab=4
  author:
  - family: Social Progress Imperative
  id: socialprog
  issued:
    year: 2018
  title: Social Progress Index
- URL: http://reports.weforum.org/global-gender-gap-report-2016/measuring-the-global-gender-gap/
  author:
  - family: World Economic Forum
  id: wef_gender_desc
  issued:
    year: 2016
  title: Measuring the Global Gender Gap
- URL: http://reports.weforum.org/global-gender-gap-report-2016/rankings/
  author:
  - family: World Economic Forum
  id: wef_gender
  issued:
    year: 2016
  title: Gender Equality
- URL: http://worldhappiness.report/ed/2018/
  author:
  - family: Helliwell
    given: John F.
  - family: Layard
    given: Richard
  - family: Sachs
    given: Jeffrey D.
  id: whr
  issued:
    year: 2018
  title: World Happiness Report
- URL: https://github.com/kmprioliPROF/MAT_8790_Final_Project
  author:
  - family: Prioli
    given: Katherine M.
  id: kmpgit_8790
  issued:
    month: 12
    year: 2018
  title: MAT_8790_Final_Project
- URL: https://github.com/kmprioliPROF/MAT_8452_Final_Project
  author:
  - family: Prioli
    given: Katherine M.
  id: kmpgit
  issued:
    month: 12
    year: 2018
  title: MAT_8452_Final_Project
abstract: "BACKGROUND Increasing globalization has generated interest in comparing countries by key quality of life (QoL) measures such as life expectancy, gender equality, and happiness, among others.  When considering how countries compare by QoL, it is vital to understand how the measures are related, if at all, and in what ways the statistical tests chosen affect the results.  This study aimed to explore the distributions of and relationships between QoL measures using both nonparametric and parametric approaches, and to assess which methods were appropriate.  METHODS A dataset containing country names and selected QoL measures for 2016 was explored through descriptive statistics and sensible univariate and bivariate visualizations.  Six sets of hypotheses pertaining to relationships within the data were generated and tested with both nonparametric methods and their parametric equivalents, and results of these parallel analyses and the assumptions they require were compared.  RESULTS Most variables in the study were not normally distributed, and several appeared associated on correlation matrix analysis.  Parallel tests included two one-sample tests, two tests for correlation, one two-sample test, and one *k*-sample test.  Across all tests performed, nonparametric methods dominated, performing acceptably for all six cases, whereas parametric methods were acceptable in only three cases.  CONCLUSION Nonparametric methods represent a powerful, important toolset for use in analyzing data that fail the assumptions needed for traditional parametric methods."
---


<!-- ### **Loading libraries** -->

```{r setup, include = FALSE, echo = FALSE, results = 'hide', warning = FALSE, message = FALSE}
library(tidyverse)
library(readxl)          # For importing .xls(x) datasets
library(lazyeval)        # For renaming columns in function
library(countrycode)     # For establishing uniform country identifiers
library(ggthemr)         # For prettifying output
library(gridExtra)       # For grid.arrange()
library(grid)            # For textGrob() to annotate grid.arrange() elements
library(kableExtra)      # For nicer output tables
library(GGally)          # For ggpairs() correlation matrix
library(BSDA)            # For SIGN.test()
library(nortest)         # For lillie.test()
library(testforDEP)      # For testforDEP()
library(jmuOutlier)      # For perm.f.test()
library(car)             # For leveneTest()

ggthemr("fresh")
```


## **Background**

With increasing economic globalization, a natural topic of interest is how the world's nations compare with respect to quality of life (QoL).  Several organizations monitor global QoL indicators and report single-dimension or aggregate values for indicators of interest.  For example, the World Bank reports Gross Domestic Product (GDP), which is a single-dimension indicator often strongly predictive of QoL in a given country (@worldbank_gdp).  Additionally, the World Health Organization reports infant mortality rate, life expectancy at birth, and life expectancy at 60 years of age (@who_infantmort, @who_life).

Other quality of life measures represent compound scores or indices based on several inputs.  For example, the United Nations calculates an annual Human Development Index (HDI), representing the developmental level of each country on a scale of zero to one based on several factors, including life expectancy at birth, years of schooling, and per-capita income (@un_dvlpt_HDIdesc).  The HDI also categorizes countries into four levels of development (low, medium, high, and very high).  Similarly, the Social Progress Imperative publishes the Social Progress Index (SPI), ranging from 0 to 100, and comprising over 50 dimensions in three broad categories:  basic human needs (e.g., nutrition, safety), foundations of wellbeing (e.g., basic knowledge, environmental quality), and opportunity (e.g., personal rights, freedoms) (@socialprog_desc).  The World Economic Forum's Global Gender Gap Index reports a gender equality index, scaled from 0-1, based on measurements of gender-related gaps in such dimensions as economic participation, level of education, health and survival, and political offices held (@wef_gender_desc).  Finally, the World Happiness Report calculates a score from 0-10 by considering per-capita GDP, healthy life expectancy, social support, freedoms, and perception of corruption, among others (@whr).

When studying QoL by country, it is important to understand how each QoL measure is distributed and how they may be interrelated.  The objective of this analysis was to explore the distributions of and relationships between key QoL indicators using both nonparametric and parametric methods, and to assess the appropriateness of each method used.


## **Methods**

### *Data Exploration*

The dataset used in this analysis, titled `alldata`, was generated for the MAT 8790 course (@kmpgit_8790).  It consists of country-level variables for calendar year 2016 as described in Table 1.

**Table 1.  `alldata` dataframe contents.**

| **Source**       	              | **Variable Name**   | **Description**                                  	          |
|-------------------------------- |-------------------- |------------------------------------------------------------	|
| `countrycode` package           | `country`           | Country names                                               |
| @socialprog      	              | `SPI`               | Social Progress Index value (scale of 0:100)     	          |
| @worldbank_gdp   	              | `logGDP`            | Gross Domestic Product, log transform                     	|
| @un_dvlpt        	              | `HDIrank`           | Human Development Index ranking                  	          |
| @un_dvlpt        	              | `HDIindex`          | HDI index value (scale of 0:1)                   	          |
| @un_dvlpt        	              | `HDI_cat`           | HDI index category (4 levels)                    	          |
| @whr             	              | `happiness`         | World Happiness Score (scale of 0:10)            	          |
| @wef_gender      	              | `gendereq`        	| Gender Equality Index (scale of 0:1)             	          |
| @who_infantmort  	              | `infantmort`        | Infant mortality rate                            	          |
| @who_life        	              | `birth_MF`          | Life expectancy at birth, males & females        	          |
| @who_life        	              | `sixty_MF`          | Life expectancy at 60 years, males & females     	          |

All variables represent data from calendar year 2016.  Countries having missing data were omitted from the dataset to ensure that the tests of interest could be performed.

For each variable except `country`, descriptive statistics were run and a sensible visualization was generated, following which a correlation matrix was produced to examine pairwise relationships between continuous variables.


### *Nonparametric and Parametric Analyses*

Based on the data exploration results, six sets of formal hypotheses were generated about the data (Table 2), and sensible nonparametric tests and their parametric equivalents were chosen to test these hypotheses.

**Table 2.  Analyses Performed**

```{r generate_table2, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
tbl2_test <- c(1:6)
tbl2_vars <- c("HDIindex",
               "HDIindex, SPI",
               "logGDP, gendereq",
               "happiness",
               "HDI_cat, log(infantmort)",
               "HDI_cat, happiness")
tbl2_null <- c("(No formal hypothesis test) Nonparametric 95% confidence interval for the population mean",
               "Human development and social progress are not associated",
               "There is no relationship between log(GDP) and gender equality index",
               "Happiness is normally distributed",
               "Log infant mortality rate is the same across levels of human development",
               "The Medium and High HDI category populations have the same scale for happiness")
tbl2_alt <- c("(No formal hypothesis test) Parametric 95% confidence interval for the population mean",
              "Human development and social progress are correlated",
              "There is a relationship between log(GDP) and gender equality index",
              "Happiness is not normally distributed",
              "Log infant mortality rate differs by level of human development",
              "The Medium and High HDI category populations differ in scale for happiness")
tbl2_nonpara <- c("Bootstrapping",
                  "Kendall's Tau",
                  "Hoeffding's Test",
                  "One-Sample Kolmogorov-Smirnov Test",
                  "Permutation F-Test",
                  "Two-Sample Wilcoxon Rank-Sum and Ansari-Bradley Tests")
tbl2_para <- c("One-Sample t-Test",
               "Pearson's Correlation Test",
               "Pearson's Correlation Test",
               "Shapiro-Wilk Test",
               "ANOVA",
               "Two-Sample t-Test and Levene's Test of Homogeneity")
tbl2 <- as.tibble(cbind(tbl2_test, tbl2_vars, tbl2_null, tbl2_alt, tbl2_nonpara, tbl2_para))
colnames(tbl2) <- c("Analysis", "Variable(s)", "Null Hypothesis", "Alternative Hypothesis", "Nonparametric Test", "Parametric Test")
tbl2_kbl <- tbl2 %>% 
  kable(format = "latex") %>% 
  column_spec(1, width = "4em", border_left = FALSE, border_right = FALSE) %>%
  column_spec(2, width = "6em", border_left = FALSE, border_right = FALSE) %>% 
  column_spec(3, width = "12em", border_left = FALSE, border_right = FALSE) %>% 
  column_spec(4, width = "12em", border_left = FALSE, border_right = FALSE) %>% 
  column_spec(5, width = "7em", border_left = FALSE, border_right = FALSE) %>% 
  column_spec(6, width = "7em", border_left = FALSE, border_right = FALSE)
tbl2_kbl
```

In Analysis #1, bootstrapping and the one-sample *t*-test were employed to find nonparametric and parametric 95% confidence intervals (CIs) for the population mean.  The widths of these intervals were compared, and assumptions required for the *t*-test were assessed.  The bootstrapping CI for the mean was found using 1,000 sampling iterations with replacement via `sample()`, and the CI for the mean was found via `t.test()`.

Analysis #2 was motivated by the correlation matrix analysis, which indicates a linear relationship is likely between `SPI` and `HDIindex`.  Kendall's Tau was chosen as the nonparametric test, with the usual Pearson's test as the parametric alternative.  Both tests assume continuous data and are equipped to detect linear dependence, and employed two-sided alternatives.  Additionally, because simulation is the preferred method when ties are present for Kendall's Tau, the variables were first assessed for ties before selecting a method for Kendall's Tau.  The competing hypotheses for this analysis were $H_{0}: \tau = 0$ vs. $H_{A}: \tau \ne 0$ (for Kendall's Tau) and $H_{0}: \rho = 0$ vs. $H_{A}: \rho \ne 0$ (for Pearson's Test).  Both tests were carried out via `cor.test()` using `method = "kendall"` or `method = "pearson"` as appropriate.

Correlation tests were chosen for Analysis #3 to determine whether log GDP and gender equality were associated.  No obvious relationship was seen between these two variables on the correlation plot.  Hoeffding's Test was selected because it is sensitive to any departure from independence, and Pearson's test was chosen as the parametric comparator.  Both tests employed two-sided alternatives and assume continuous data, and Pearson's test additionally assumes a linear relationship.  For Hoeffding's test, the formal hypotheses tested were $H_{0}:  \Delta = 0$ vs. $H_{A}:  \Delta \ne 0$ where $$\Delta = \int\limits_{X \in x}\int\limits_{Y \in y}[F_{XY}(x, y) - F_{X}(x)F_{Y}(y)]^{2} dF_{XY}(x, y).$$  For Pearson's test, the competing hypotheses were $H_{0}: \rho = 0$ versus $H_{A}: \rho \ne 0$.  These tests were carried out using `testforDEP::testforDEP()` with the options `test = "HOEFFD"` and `test = "PEARSON"` respectively.

Analysis #4 was chosen because `happiness` appears to have a symmetric, possibly normal distribution on univariate analysis.  To test for normality, the Lilliefors test (a normality-specific version of the one-sample Kolmogorov-Smirnov test) was chosen as the nonparametric test, and the Shapiro-Wilk test was chosen as the parametric alternative.  Both assume a continuous sample distribution.  The formal hypotheses for this analysis were $H_{0}:$ `happiness` is normally distributed vs. for $H_{A}:$ `happiness` is not normally distributed.  Lilliefors testing was performed via `nortest::lillie.test()`, and Shapiro-Wilk testing was carried out using `shapiro.test()`. 

To test for a difference in infant mortality rate by human development category, Analysis #5 employed the permutation F-test and ANOVA as the nonparametric and parametric tests respectively.  Both tests assume samples are independent with constant variance, and ANOVA additionally assumes a normal distribution.  The log transform of infant mortality rate was used to ensure that the assumption of constant variance would be met.  The competing hypotheses were $H_{0}:$  the cumulative distribution functions (CDFs) for log infant mortality were equal across all four human development levels vs. $H_{A}:$  at least one of these CDFs differs.  The permutation F-test was performed via `jmuOutlier::perm.f.test()` with 1,000 simulations because the sample size was prohibitively large for calculating an exact *p*-value.  The `aov()` function was used for ANOVA testing.

In Analysis #6, the aim was to determine if there was a difference in scale for happiness score among the Medium and High HDI categories.  This required two two-sample tests each for the nonparametric and parametric approaches:  a test for difference in location, and a test for difference in scale.  The nonparametric tests employed were the Wilcoxon Rank-Sum Test, with $H_{0}: m_{Medium} = m_{High}$ vs. $H_{A}: m_{Medium} \ne m_{High}$, and the Ansari-Bradley Test, with $H_{0}:$ the populations have the same spread vs. $H_{A}:$ the populations differ in spread.  For the parametric approach, the two-sample *t*-test provided the test of location, assessing $H_{0}:  \mu_{Medium} = \mu_{High}$ vs. $H_{A}:  \mu_{Medium} \ne \mu_{High}$, and Levene's Test for Homogeneity was used to test for a difference in variance, with competing hypotheses $H_{0}:  \sigma^{2}_{Medium} = \sigma^{2}_{High}$ and $H_{A}:  \sigma^{2}_{Medium} \ne \sigma^{2}_{High}$.  The Wilcoxon Rank-Sum test was carried out via `wilcox.test()`, the Ansari-Bradley test via `ansari.test()`, the *t*-test via `t.test()`, and Levene's test via `car::leveneTest()`.  All tests assume independence of observations; the parametric tests further assume normality.

Results of these six paired analyses were compared in the context of the data and assumptions needed.  All tests were performed at level $\alpha = 0.05$ in R.  The dataset, full code, and this report are available in an online repository (@kmpgit).


## **Results**

<!-- ### **Importing data** -->

```{r import_data, include = FALSE, echo = FALSE, message = FALSE, warning = FALSE}
alldata <- read_csv("MAT_8790_alldata_2018-12-02.csv")
alldata <- alldata %>% 
  na.omit() %>% 
  mutate(country = factor(country)) %>% 
  mutate(HDI_cat = factor(HDI_cat, levels = c("Low", "Medium", "High", "Very High")))
glimpse(alldata)

len <- dim(alldata)[[1]]


fulldata <- read_csv("MAT_8790_alldata_2018-12-02.csv")
fulldata <- fulldata %>% 
  mutate(country = factor(country)) %>% 
  mutate(HDI_cat = factor(HDI_cat, levels = c("Low", "Medium", "High", "Very High")))

omitted <- anti_join(fulldata, alldata, by = "country")
```


### *Data Exploration*

The original dataset represented `r dim(fulldata)[[1]]` countries, and the analytic dataset contained `r dim(alldata)[[1]]` countries after omitting those with missing values.  Of the 94 countries omitted, 26 were highly developed by HDI category, 20 were in the low developmental category, and 18 had unknown HDI category (Table 3).

**Table 3.  Omitted Countries by HDI Category**

```{r omitted_by_HDI, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
omitted_HDIcat <- table(omitted$HDI_cat, useNA = "ifany")

omitted_HDIcat <- as.tibble(omitted_HDIcat)
colnames(omitted_HDIcat) <- c("HDI Category", "Frequency")
omitted_HDIcat_kbl <- omitted_HDIcat %>% kable(format = "markdown")
omitted_HDIcat_kbl
```

Descriptive statistics and univariate visualizations are presented in Figs. 1-8.  Figure 1 depicts the distribution and descriptive statistics of the `HDIindex` variable, along with counts by country for the `HDI_cat` variable.  `HDIindex` has a very nonnormal appearance, yet has similar mean and median, and a small standard deviation as compared to the mean.  The highest category of human development is the most represented in the data.

```{r HDIplots, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 4}
HDIindex_hist <- ggplot(data = alldata, aes(x = HDIindex)) +
  geom_histogram(bins = ceiling(sqrt(len - sum(is.na(alldata$HDIindex))))) +
  xlab("Human Development Index") +
  ylab("Count") +
  ggtitle("HDI Distribution")

HDIcat_bar <- ggplot(data = alldata, aes(x = HDI_cat)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), color = "#233b43",
            hjust = 0.5, position = position_stack(vjust = 0.5)) +
  xlab("Human Development Category") +
  ylab("Count") +
  ggtitle("Country Counts by HDI Category")

HDIsumm <- broom::tidy(round(summary(alldata$HDIindex), digits = 3))
sd <- round(sd(alldata$HDIindex), digits = 3)
HDIsumm <- cbind(HDIsumm, sd)
colnames(HDIsumm) <- c("Min", "Q1", "Median", "Mean", "Q3", "Max", "SD")
HDIsumm_grob <- tableGrob(HDIsumm, theme = ttheme_minimal(), rows = NULL)

grid.arrange(HDIindex_hist, HDIcat_bar, HDIsumm_grob, nrow = 2, heights = c(0.8, 0.2),
             top = textGrob("Figure 1.  Human Development Index", 
                            gp = gpar(fontsize = 14, fontface = "bold", col = "#545454"),
                            x = 0.025, hjust = 0))
```

`SPI`, described in Fig. 2, appears to have a multimodal distribution, with mean and median quite similar in value.

```{r SPIplot, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 4}
SPI_hist <- ggplot(data = alldata, aes(x = SPI)) +
  geom_histogram(bins = ceiling(sqrt(len - sum(is.na(alldata$SPI))))) +
  xlab("Social Progress Index") +
  ylab("Count") +
  ggtitle("Figure 2.  Social Progress Index Distribution")

SPIsumm <- broom::tidy(round(summary(alldata$SPI), digits = 3))
sd <- round(sd(alldata$SPI), digits = 3)
SPIsumm <- cbind(SPIsumm, sd)
colnames(SPIsumm) <- c("Min", "Q1", "Median", "Mean", "Q3", "Max", "SD")
SPIsumm_grob <- tableGrob(t(SPIsumm), theme = ttheme_minimal())

grid.arrange(SPI_hist, SPIsumm_grob, nrow = 1, widths = c(0.8, 0.2))
```

The distribution of `logGDP` (Fig. 3) appears possibly bimodal with mean and median reasonably close in value and standard deviation smaller than both.

```{r GDPplot, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 4}
GDP_hist <- ggplot(data = alldata, aes(x = logGDP)) +
  geom_histogram(bins = ceiling(sqrt(len))) +
  xlab("log(GDP)") +
  ylab("Count") +
  ggtitle("Figure 3.  Gross Domestic Product Distribution, Log Transform")

logGDPsumm <- broom::tidy(round(summary(alldata$logGDP), digits = 3))
sd <- round(sd(alldata$logGDP), digits = 3)
logGDPsumm <- cbind(logGDPsumm, sd)
colnames(logGDPsumm) <- c("Min", "Q1", "Median", "Mean", "Q3", "Max", "SD")
logGDPsumm_grob <- tableGrob(t(logGDPsumm), theme = ttheme_minimal())

grid.arrange(GDP_hist, logGDPsumm_grob, nrow = 1, widths = c(0.8, 0.2))
```

Per Fig. 4, the World Happiness Score appears roughly normally distributed.

```{r happinessplot, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 4}
happiness_hist <- ggplot(data = alldata, aes(happiness)) +
  geom_histogram(bins = ceiling(sqrt(len - sum(is.na(alldata$happiness))))) +
  xlab("Happiness Score") +
  ylab("Count") +
  ggtitle("Figure 4.  Happiness Score Distribution")

happinesssumm <- broom::tidy(round(summary(alldata$happiness), digits = 3))
sd <- round(sd(alldata$happiness), digits = 3)
happinesssumm <- cbind(happinesssumm, sd)
colnames(happinesssumm) <- c("Min", "Q1", "Median", "Mean", "Q3", "Max", "SD")
happinesssumm_grob <- tableGrob(t(happinesssumm), theme = ttheme_minimal())

grid.arrange(happiness_hist, happinesssumm_grob, nrow = 1, widths = c(0.8, 0.2))
```

Figure 5 shows a roughly symmetric, possibly trimodal distribution for `gendereq`, with mean and median very close in value, and standard deviation approximately a tenth of either measure of location.

```{r genderplot, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 4}
gender_hist <- ggplot(data = alldata, aes(x = gendereq)) +
  geom_histogram(bins = ceiling(sqrt(len - sum(is.na(alldata$gendereq))))) +
  xlab("Gender Equality Index") +
  ylab("Count") +
  ggtitle("Figure 5.  Gender Equality Index Distribution")

gendersumm <- broom::tidy(round(summary(alldata$gendereq), digits = 3))
sd <- round(sd(alldata$gendereq), digits = 3)
gendersumm <- cbind(gendersumm, sd)
colnames(gendersumm) <- c("Min", "Q1", "Median", "Mean", "Q3", "Max", "SD")
gendersumm_grob <- tableGrob(t(gendersumm), theme = ttheme_minimal())

grid.arrange(gender_hist, gendersumm_grob, nrow = 1, widths = c(0.8, 0.2))
```

The probability of infant mortality is heavily right-skewed per Fig. 6.

```{r infantmortplot, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 4}
infantmort_hist <- ggplot(data = alldata, aes(x = infantmort)) + 
  geom_histogram(bins = ceiling(sqrt(len - sum(is.na(alldata$gendereq))))) +
  xlab("Probability of Infant Mortality") +
  ylab("Count") +
  ggtitle("Figure 6.  Infant Mortality Distribution")

infantmortsumm <- broom::tidy(round(summary(alldata$infantmort), digits = 3))
sd <- round(sd(alldata$infantmort), digits = 3)
infantmortsumm <- cbind(infantmortsumm, sd)
colnames(infantmortsumm) <- c("Min", "Q1", "Median", "Mean", "Q3", "Max", "SD")
infantmortsumm_grob <- tableGrob(t(infantmortsumm), theme = ttheme_minimal())

grid.arrange(infantmort_hist, infantmortsumm_grob, nrow = 1, widths = c(0.8, 0.2))
```

Figure 7 explores total life expectancy at birth vs. age 60.  Life expectancy at birth appears left-skewed, but total life expectancy at sixty looks reasonably symmetric.  These data indicate that, across all countries, a person who survives until at least 60 years has a longer total life expectancy than does the general world population at birth.

```{r lifeexpplot, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 4}
lifeexp_birth_box <- ggplot(data = alldata, aes(y = birth_MF)) +
  geom_boxplot() +
  ylim(50, 100) +
  ylab("Total Life Expectancy (years)") +
  ggtitle("...at Birth") +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank())

lifeexp_sixty_box <- ggplot(data = alldata, aes(y = 60 + sixty_MF)) +
  geom_boxplot() +
  ylim(50, 100) +
  ylab("") +
  ggtitle("...at Age 60") +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.y.left = element_blank())


birth_MFsumm <- broom::tidy(round(summary(alldata$birth_MF), digits = 3))
sd <- round(sd(alldata$birth_MF), digits = 3)
birth_MFsumm <- cbind(birth_MFsumm, sd)
colnames(birth_MFsumm) <- c("Min", "Q1", "Median", "Mean", "Q3", "Max", "SD")
birth_MFsumm_grob <- tableGrob(birth_MFsumm, theme = ttheme_minimal(), rows = NULL)

sixty_MFsumm <- broom::tidy(round(summary(alldata$sixty_MF + 60), digits = 3))
sd <- round(sd(alldata$sixty_MF + 60), digits = 3)
sixty_MFsumm <- cbind(sixty_MFsumm, sd)
colnames(sixty_MFsumm) <- c("Min", "Q1", "Median", "Mean", "Q3", "Max", "SD")
sixty_MFsumm_grob <- tableGrob(sixty_MFsumm, theme = ttheme_minimal(), rows = NULL)


grid.arrange(lifeexp_birth_box, lifeexp_sixty_box, 
             birth_MFsumm_grob, sixty_MFsumm_grob, 
             nrow = 2, heights = c(0.8, 0.2),
             top = textGrob("Figure 7.  Total Life Expectancy...",
                            gp = gpar(fontsize = 14, fontface = "bold", col = "#545454"),
                            x = 0.025, hjust = 0))
```

Figure 8 depcits pairwise relationships between these variables.  Strong positive linear relationships are seen between `HDIindex` and `SPI`, `HDIindex` and `birth_MF`, and `SPI` and `birth_MF`, indicating that higher levels of social progress and human development generally correlate with a longer life expectancy at birth.  Additionally, positive linear relationships are seen between `happiness` and `birth_MF`, between `happiness` and `HDIindex`, and between `happiness` and `SPI`, indicating that increasing levels of human development and social progress generally lead to increased happiness (though there is considerable spread in the data), and that happiness and longevity may also be correlated.

Strong negative relationships are seen between `infantmort` and `birth_MF`, between `HDIindex` and `infantmort`, and between `SPI` and `infantmort`, though the latter two of these may not necessarily be linear.  These indicate that increasing human development and social progress levels correlate with lower levels of infant mortality, and that as infant mortality decreases, life expectancy at birth increases.

```{r calc_corrplot, echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 8}
corrplot <- ggpairs(data = alldata, columns = c(4:5, 2, 11, 6:10),
                    title = "Figure 8.  Correlation Matrix")
corrplot
```

### *Nonparametric and Parametric Analyses*

<!-- ### *Analysis #1* -->

```{r analysis1, include = FALSE, echo = FALSE}
n <- length(alldata$HDIindex)
nBS <- 1000
set.seed(19811221)

BSout <- tibble(BSmean = numeric())

for(bs in 1:nBS){
  bsHDIindex <- sample(alldata$HDIindex, n, replace = TRUE)
  BSout[bs, 1] <- mean(bsHDIindex)
}

meanCI_BS <- tibble(CI_low = numeric(),
                    CI_high = numeric(),
                    width = numeric())

meanCI_BS[1, 1] <- round(quantile(BSout$BSmean, 0.025), digits = 4)
meanCI_BS[1, 2] <- round(quantile(BSout$BSmean, 0.975), digits = 4)
meanCI_BS$width = meanCI_BS$CI_high - meanCI_BS$CI_low

analysis1_nonpara <- meanCI_BS
analysis1_nonpara


analysis1_ttest <- t.test(alldata$HDIindex,
                          alternative = "two.sided",
                          conf.level = 0.95)

meanCI_ttest <- tibble(CI_low = numeric(),
                       CI_high = numeric(),
                       width = numeric())

meanCI_ttest[1, 1] <- round(analysis1_ttest$conf.int[1], digits = 4)
meanCI_ttest[1, 2] <- round(analysis1_ttest$conf.int[2], digits = 4)
meanCI_ttest$width = meanCI_ttest$CI_high - meanCI_ttest$CI_low

analysis1_para <- meanCI_ttest
analysis1_para
```

In Analysis #1, the bootstrapping approach yielded a 95% CI for the mean of (`r analysis1_nonpara[[1]]`, `r analysis1_nonpara[[2]]`), having width `r analysis1_nonpara[[3]]`.  The parametric approach via `t.test()` yielded a 95% CI given by (`r analysis1_para[[1]]`, `r analysis1_para[[2]]`), having width `r analysis1_para[[3]]`.  The nonparametric method gave the smaller confidence interval, having `r paste0(round((analysis1_nonpara[[3]] / analysis1_para[[3]]) * 100, digits = 2), "%")` the width of the CI obtained through the parametric method.  The one-sample *t*-test assumes that the sample is random with independent draws, and that the data are continuous and normally distributed.  Independence and continuous data are met, but per Fig. 1, normality is violated, so the parametric approach is not appropriate.  The nonparametric approach is acceptable.


<!-- ### *Analysis #2* -->

```{r analysis2, include = FALSE, echo = FALSE}

# Assessing presence of ties (would require simulation for Kendall's Test)

SPI_ties <- alldata %>% 
  group_by(SPI) %>% 
  mutate(count = n()) %>% 
  ungroup() %>% 
  select(count) %>% 
  filter(count > 1)
dim(SPI_ties)[[1]]          # No ties

HDIindex_ties <- alldata %>% 
  group_by(HDIindex) %>% 
  mutate(count = n()) %>% 
  ungroup() %>% 
  select(count) %>% 
  filter(count > 1)
dim(HDIindex_ties)[[1]]     # No ties

analysis2_nonpara <- cor.test(alldata$SPI, alldata$HDIindex, method = "kendall")
analysis2_nonpara

analysis2_para <- cor.test(alldata$SPI, alldata$HDIindex, method = "pearson")
analysis2_para
```

For Analysis #2, ties were not present in either `SPI` or `HDIindex`; thus, Kendall's Tau was tested using the usual `cor.test(x, y, method = "kendall")` approach.  When testing for independence in both the nonparametric and parametrics cases, the *p*-values were less than 0.0001, with correlation coefficients $r_{\tau}$ = `r round(analysis2_nonpara$estimate, digits = 3)[[1]]` and *r* = `r round(analysis2_para$estimate, digits = 3)[[1]]` respectively.  Both are statistically significant and represent strong evidence of a linear relationship between social progress and human developmental level, thus $H_{0}$ was rejected with the conclusion that, at the $\alpha = 0.05$ level, social progress and human development are correlated.  Both tests assume continuous data, which is satisfied, and both yield the same *p*-value.  Both the nonparametric and parametric methods are appropriate.


<!-- ### *Analysis #3* -->

```{r analysis3, include = FALSE, echo = FALSE}
analysis3_nonpara <- testforDEP(alldata$logGDP, alldata$gendereq, test = "HOEFFD")
analysis3_nonpara

analysis3_para <- testforDEP(alldata$logGDP, alldata$gendereq, test = "PEARSON")
analysis3_para
```

When testing for independence in Analysis #3, Hoeffding's test returned $p_{Hoeffding} =$ `r round(analysis3_nonpara@p_value, digits = 4)`, whereas Pearson's test yielded $p_{Pearson} =$ `r round(analysis3_para@p_value, digits = 4)`.  Hoeffding's test led to the rejection of $H_{0}$ (i.e., independence) and the conclusion that, at the $\alpha = 0.05$ level, there is sufficient evidence of an association between log(GDP) and gender equality.  Pearson's test, however, resulted in retaining $H_{0}$ and concluding that, at the $\alpha = 0.05$ level, there is insufficient evidence of an association between log(GDP) and gender equality.  The assumptions of continuous data were met for both tests, but the assumption of linearity failed for Pearson's test, thus the parametric method is inappropriate.


<!-- ### *Analysis #4* -->

```{r analysis4, include = FALSE, echo = FALSE}
analysis4_nonpara <- lillie.test(alldata$happiness)
analysis4_nonpara

analysis4_para <- shapiro.test(alldata$happiness)
analysis4_para
```

In Analysis #4, the Lilliefors test yielded p-value $p_{Lilliefors} =$ `r round(analysis4_nonpara$p.value, digits = 3)`, whereas the p-value for the Shapiro-Wilk test was $p_{SW}$ = `r round(analysis4_para$p.value, digits = 3)`.  Both exceed alpha; thus, $H_{0}$ was retained for both tests with the conclusion that there is insufficient evidence to assert that `happiness` is not normally distributed.  Both tests assume a continuous distribution, which is satisfied by the data, and the tests agree, so either the nonparametric or parametric approach is acceptable in this case.  Notably, although neither *p*-value is significant, $p_{SW}$ was much smaller than $p_{Lilliefors}$.  Since the objective for this analysis was to test for normality, the parametric test is more appropriate.


<!-- ### *Analysis #5* -->

```{r analysis5, include = FALSE, echo = FALSE}
analysis5_nonpara <- perm.f.test(response = log(alldata$infantmort), treatment = alldata$HDI_cat,
                                 num.sim = 1000)
analysis5_nonpara

analysis5_para <- aov(as.numeric(HDI_cat) ~ log(infantmort), data = alldata)
summary(analysis5_para)

analysis5_levene <- leveneTest(log(infantmort) ~ HDI_cat, data = alldata)
```

Both the permutation F-test and ANOVA yielded $p < 0.0001$ for Analysis #5.  Since $p < \alpha$, $H_{0}$ was rejected for both the nonparametric and parametric cases, leading to the conclusion that there exists a difference in infant mortality by HDI category.  The assumptions of independence and constant variance are satisfied by the data, the latter having *p*-value `r round(analysis5_levene[[3]][1], digits = 4)` on Levene's test for homogeneity of variances.  However, per Fig. 9, the ANOVA assumption of normality may be violated for the Medium category.  Therefore, the parametric method is inappropriate in this case, and the nonparametric method is retained.

```{r analysis5_plot, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 4}
analysis5_plot <- ggplot(data = alldata, aes(x = HDI_cat, y = log(infantmort))) +
  geom_boxplot() +
  xlab("HDI Category") +
  ylab("Infant Mortality Rate, Log Transform") +
  ggtitle("Figure 9.  Log Infant Mortality Rate by HDI Category")
analysis5_plot
```


<!-- ### *Analysis #6* -->

```{r analysis6, include = FALSE, echo = FALSE}
happiness_med <- alldata %>% 
  filter(HDI_cat == "Medium") %>% 
  select(happiness)

happiness_high <- alldata %>% 
  filter(HDI_cat == "High") %>% 
  select(happiness)

happiness_medhigh <- alldata %>% 
  filter(HDI_cat %in% c("Medium", "High")) %>% 
  select(happiness, HDI_cat)

analysis6_nonpara_median <- wilcox.test(happiness_med$happiness, happiness_high$happiness)
analysis6_nonpara_median

analysis6_para_mean <- t.test(happiness_med$happiness, happiness_high$happiness)
analysis6_para_mean

analysis6_nonpara_scale <- ansari.test(happiness_med$happiness, happiness_high$happiness)
analysis6_nonpara_scale

analysis6_para_variance <- leveneTest(happiness ~ HDI_cat, data = happiness_medhigh)
analysis6_para_variance
```

In Analysis #6, both the Wilcoxon Rank-Sum Test and *t*-test were nonsignificant, with $p_{Wilcoxon}$ = `r round(analysis6_nonpara_median$p.value, digits = 4)` and $p_{t}$ = `r round(analysis6_para_mean$p.value, digits = 4)`.  The happiness data meets normality (Fig. 10), so either the nonparametric or parametric method is acceptable.  $H_{0}$ was retained with the conclusion that the happiness score does not differ in location across the Medium and High HDI categories.  Since the assumption of equal location was retained, the tests for difference in scale were performed.  The Ansari-Bradley test was nonsignificant at $p_{AB}$ = `r round(analysis6_nonpara_scale$p.value, digits = 4)`, and Levene's Test was also nonsignificant, having $p_{Levene}$ = `r round(analysis6_para_variance[1, 3], digits = 4)`.  Both tests resulted in failure to reject $H_{0}$ and the conclusion that the happiness score does not differ in scale across the two HDI categories in question.  It is worth noting that visual inspection of Fig. 10 seems to indicate a difference in scale by category, but this was not supported by the Ansari-Bradley and Levene's Test findings.


```{r analysis6_plot, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 4}
analysis6_plot <- ggplot(data = happiness_medhigh, aes(x = HDI_cat, y = happiness)) +
  geom_boxplot() +
  xlab("HDI Category") +
  ylab("Happiness Score") +
  ggtitle("Figure 10.  Happiness Score by Medium and High HDI Categories")
analysis6_plot
```


## **Discussion**

This study assessed performance and appropriateness of nonparametric methods as compared to their parametric counterparts in a series of six analyses.  In all six cases, the nonparametric methods performed acceptably, whereas the parametric methods were only appropriate in three of the cases.  Nonparametric methods are appropriate when analyzing data that violates the assumption of normality, and they can also be applied to normal data, but may be less powerful than the traditional parametric tests.  The dataset used in this study consists of real-world QoL data, many variables of which fail normality.

This study is unique in that its aim was to compare methodologies rather than pursue a specific scientific objective.  The open-ended nature of the study led to trying several analytic approaches with this data, many of which are not included in this report.  These analytic explorations were key in developing a deeper understanding of how these QoL measures are distributed and related, which became useful when working with this dataset for the MAT 8790 final project.


### *Limitations*

An important limitation to this analysis is that countries with missing data were excluded from the analytic dataset.  This may introduce bias, as a nontrivial proportion of countries omitted belong to the low and medium HDI developmental categories, and these countries are likely to perform poorly on the other QoL measures considered.

Another limitation is the inherent interrelatedness of some of these variables, particularly the compound indices.  Analysis #2 showed that Human Development Index and Social Progress Index are strongly associated.  Though these variables are of different scale (0:1 for `HDIindex`, and 0:100 for `SPI`) and only intersect on a subset of their subitems, they perform extremely similarly.  This finding limits the analyses possible with this dataset.  Another example of interrelatedness is that one factor considered in the Human Development Index is life expectancy, so it is unsurprising that a strong association between `HDIindex` and `birth_MF` was seen in the correlation matrix.  Similarly, some subitems of the Social Progress Index overlap with those included in the Gender Equality Index.  Correlation tests are possible in such cases but may be inappropriate unless the underlying measures are fundamentally different.

Finally, this study is limited by the variables included in this dataset, which were chosen with a different research aim in mind.  There exist many other QoL measures that would have been worth including in this analysis, such as measures of educational attainment, civilian indebtedness, and population-level health utilities.  Future work may entail expanding the study to include such variables.


## **Conclusion**

Nonparametric methods represent an important toolset when working with data that violates normality.  This analysis gives evidence that they can perform favorably as compared to their parametric equivalents, and should be considered when analyzing data that is unsuitable for parametric approaches.


## **References**